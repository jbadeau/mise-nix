[env]
LUA_PATH="lib/?.lua;;"
NX_NO_CLOUD=true

[tools]
# lua via brew (asdf plugin has LuaRocks 3.13.0 bug)
node = "24.5.0"
github-cli = "2.83.2"
shellspec = "0.28.1"

[tasks.init]
description = "init"
run = [
    'mise plugin link nix $PWD --force',
    'command -v lua >/dev/null || (echo "Install lua: brew install lua luarocks" && exit 1)',
    'luarocks install busted --force'
]

[tasks.test]
description = "test"
run = "busted -p %.spec%.lua lib"

[tasks.e2e]
description = "e2e"
run = "shellspec"

[tasks.nuke]
description = "nuke"
run = [
    "mise uninstall --all nix:*",
    "rm -rf ~/.cache/mise/nix-builds/* /tmp/mise-nix-cache/* 2>/dev/null",
    "sudo nix-collect-garbage -d && sudo nix --extra-experimental-features nix-command store gc --max 0"
]

[settings]
experimental=true